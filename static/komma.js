/*
 * jQuery scrollintoview() plugin and :scrollable selector filter
 * https://github.com/litera/jquery-scrollintoview
 *
 * Version 1.8 (14 Jul 2011)
 * Requires jQuery 1.4 or newer
 *
 * Copyright (c) 2011 Robert Koritnik
 * Licensed under the terms of the MIT license
 * http://www.opensource.org/licenses/mit-license.php
 */
"use strict";(function(f){var c={vertical:{x:false,y:true},horizontal:{x:true,y:false},both:{x:true,y:true},x:{x:true,y:false},y:{x:false,y:true}};var b={duration:"fast",direction:"both"};var e=/^(?:html)$/i;var g=function(k,j){j=j||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(k,null):k.currentStyle);var i=document.defaultView&&document.defaultView.getComputedStyle?true:false;var h={top:(parseFloat(i?j.borderTopWidth:f.css(k,"borderTopWidth"))||0),left:(parseFloat(i?j.borderLeftWidth:f.css(k,"borderLeftWidth"))||0),bottom:(parseFloat(i?j.borderBottomWidth:f.css(k,"borderBottomWidth"))||0),right:(parseFloat(i?j.borderRightWidth:f.css(k,"borderRightWidth"))||0)};return{top:h.top,left:h.left,bottom:h.bottom,right:h.right,vertical:h.top+h.bottom,horizontal:h.left+h.right}};var d=function(h){var j=h.closest("html");var i=e.test(h[0].nodeName);return{border:i?{top:0,left:0,bottom:0,right:0}:g(h[0]),scroll:{top:(i?j:h).scrollTop(),left:(i?j:h).scrollLeft()},scrollbar:{right:i?0:h.innerWidth()-h[0].clientWidth,bottom:i?0:h.innerHeight()-h[0].clientHeight},rect:(function(){var k=h[0].getBoundingClientRect();return{top:i?0:k.top,left:i?0:k.left,bottom:i?h[0].clientHeight:k.bottom,right:i?h[0].clientWidth:k.right}})()}};f.fn.extend({scrollintoview:function(j){j=f.extend({},b,j);j.direction=c[typeof(j.direction)==="string"&&j.direction.toLowerCase()]||c.both;var n="";if(j.direction.x===true){n="horizontal"}if(j.direction.y===true){n=n?"both":"vertical"}var l=this.eq(0);var i=l.closest(":scrollable("+n+")");if(i.length>0){i=i.eq(0);var m={e:d(l),s:d(i)};var h={top:m.e.rect.top-(m.s.rect.top+m.s.border.top),bottom:m.s.rect.bottom-m.s.border.bottom-m.s.scrollbar.bottom-m.e.rect.bottom,left:m.e.rect.left-(m.s.rect.left+m.s.border.left),right:m.s.rect.right-m.s.border.right-m.s.scrollbar.right-m.e.rect.right};var k={};if(j.direction.y===true){if(h.top<0){k.scrollTop=m.s.scroll.top+h.top-25}else{if(h.top>0&&h.bottom<0){k.scrollTop=m.s.scroll.top+Math.min(h.top,-h.bottom)+25}}}if(j.direction.x===true){if(h.left<0){k.scrollLeft=m.s.scroll.left+h.left-25}else{if(h.left>0&&h.right<0){k.scrollLeft=m.s.scroll.left+Math.min(h.left,-h.right)+25}}}if(!f.isEmptyObject(k)){if(e.test(i[0].nodeName)){i=l.closest("html");i.add("body",i)}i.animate(k,j.duration).eq(0).queue(function(o){f.isFunction(j.complete)&&j.complete.call(i[0]);o()})}else{f.isFunction(j.complete)&&j.complete.call(i[0])}}return this}});var a={auto:true,scroll:true,visible:false,hidden:false};f.extend(f.expr[":"],{scrollable:function(k,i,n,h){var m=c[typeof(n[3])==="string"&&n[3].toLowerCase()]||c.both;var l=(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(k,null):k.currentStyle);var o={x:a[l.overflowX.toLowerCase()]||false,y:a[l.overflowY.toLowerCase()]||false,isRoot:e.test(k.nodeName)};if(!o.x&&!o.y&&!o.isRoot){return false}var j={height:{scroll:k.scrollHeight,client:k.clientHeight},width:{scroll:k.scrollWidth,client:k.clientWidth},scrollableX:function(){return(o.x||o.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(o.y||o.isRoot)&&this.height.scroll>this.height.client}};return m.y&&j.scrollableY()||m.x&&j.scrollableX()}})})(jQuery);"use strict";var types_red={"@error":"@error","@comp-":"@comp-","@-comp":"@-comp","@comp-:-":"@comp-:-","@comp":"@comp","@x-etype-apostrophe":"@x-etype-apostrophe","@apostrophe":"@apostrophe","@no-apostrophe":"@no-apostrophe","@x-etype-hyphen":"@x-etype-hyphen","@hyphen-prefix":"@hyphen-prefix","@hyphen-suffix":"@hyphen-suffix",};var types_yellow={"@proper":"@proper","@new":"@new","@abbreviation":"@abbreviation","@check!":"@check!",};var types_only={"@vfin":"@vfin","@inf":"@inf","@ene":"@ene","@ende":"@ende","@comp-":"@comp-","@comp-:-":"@comp-:-","@-comp":"@-comp","@comp":"@comp","@error":"@error","@apostrophe":"@apostrophe","@no-apostrophe":"@no-apostrophe","@check":"@check","@new":"@new","@green":"@green","@proper":"@proper","@abbreviation":"@abbreviation","@upper":"@upper","@lower":"@lower",};var ctypes={"@x-etype-list":["@x-etype-list","Forkert skrevet ord","Du har skrevet et ord forkert, måske fordi det engang blev stavet sådan.<br>\n<br>\nDet kan fx være, at du skrev <i>vanilie</i> i stedet for <i>vanilje</i>, som er den eneste rigtige stavemåde."],"@x-etype-joined":["@x-etype-joined","Manglende mellemrum","Du mangler et mellemrum mellem to ord, måske fordi du har lavet en slåfejl, så to ord er skrevet forkert sammen. Det kunne fx være <i>undret mig</i>, der er skrevet ud i et <i>undretmig,</i> men også samskrivning af præposition og styrelse som fx <i>i går</i> og <i>i dag</i>, der skal skrives hver for sig."],"@x-etype-sær":["@x-etype-sær","Manglende sammenskrivning","Du har undladt at skrive to ord sammen, som i denne sammenhæng skal være skrevet sammen. Grammatisk kan ordene stå hver for sig, men betydningen ændres, når de skrives sammen. Der er fx stor forskel på en <i>engelsk</i> <i>lærer</i> (som altså ikke er hverken dansker eller tysker) og en<i> engelsklærer</i>, som underviser i engelsk."],"@x-etype-flex":["@x-etype-flex","Bøjningsfejl","Du har brugt en forkert bøjning af ordet.<br>\n<br>\nDet kunne være <i>sandet</i>, hvor der skulle stå <i>sanden,</i> eller <i>huserne</i> i stedet for <i>husene.</i><br>\n<br>\nDet kan også være, hvis du har forvekslet flertalsendelserne <i>-erne</i> og <i>-ene,</i> eller datidsendelserne <i>-ede</i> og <i>-te</i>."],"@x-etype-ellision":["@x-etype-ellision","Bøjningsfejl ved ord der ender i -el/-en/-er","Du har skrevet et -<i>e</i>- for meget i ord, der ender på -<i>el,-en og -er</i>. Disse ord mister -e i sidste stavelse, når de bøjes. Det kan fx være <i>en cykel, flere cykler</i> (altså ikke cykeler), en <i>moden</i> mand → to <i>modne</i> mænd."],"@x-etype-um":["@x-etype-um","Bøjningsfejl ved ord der ender i -um","Du har brugt forkert bøjning af ord, der ender på -um.<br>\n<br>\nDet kunne fx være <i>gymnasium,</i> der bøjes <i>gymnasiet/gymnasier</i> (ikke <i>gymnasiummet/gymnasiummer</i>)."],"@x-etype-gemination":["@x-etype-gemination","Bøjningsfejl ved bogstavsfordobling","Du har bøjet ord ved at bruge dobbeltkonsonant, fx <i>en dal</i> <i>→</i><i> to daller,</i> hvor brugen af et -<i>l</i> bevarer en lang vokal. Eller du har undladt dobbeltvokal, når en kort vokal skal bevares, som fx <i>en hal → to haller.</i>"],"@x-etype-hyphen":["@x-etype-hyphen","Overflødig eller manglende bindestreg inde i ordet","Du har tilføjet en overflødig bindestreg inde i ord, som fx<i> binde-streg.</i><br>\n<br>\nEller du mangler en bindestreg, som fx <i>is- og slikfabrik</i> (fælles orddel), <i>1800-tallet</i> (tal + andet ord) og <i>wc-papir</i> (forkortelse + andet ord)."],"@error":["@error","Stavefejl","Du har lavet en almindelig stavefejl, som programmet har rettet.<br>\n<br>\nFx <i>intereseret → interesseret</i>"],"@check!":["@check!","Muligt forkert ord uden ændringsforslag","Du har skrevet et specielt ord, som kan være forkert.<br>\n<br>\nFx <i>døgntlf.-tid.</i>"],"@:...":["@:...","Forslag til rettelse ud fra sammenhæng","Du har skrevet ord med stavefejl eller forkert ordvalg.<br>\n<br>\nFx <i>esdragon</i> → <i>estragon, ud og se</i> → <i>ud at se</i>"],"@comp-":["@comp-","Særskrivningsfejl – bør sammenskrives med næste ord","Du har skrevet et ord, som skal skrives sammen, i to ord.<br>\n<br>\nFx <i>banegårds center</i> → <i>banegårdscenter</i>"],"@comp-:-":["@comp-:-","Særskrivningsfejl – bør sammenskrives med næste ord, med bindestreg","Du har skrevet et sammensat ord uden bindestreg, selvom der i denne sammensætning skal være en bindestreg.<br>\n<br>\nFx <i>FN resolution</i> → <i>FN-resolution</i>"],"@-comp":["@-comp","Særskrivningsfejl – bør sammenskrives med forudgående ord","Du har skrevet sammensat ord i to ord.<br>\n<br>\nFx <i>De havde spist for inden → De havde spist forinden</i>"],"@comp":["@comp","Særskrivningsfejl – de to dele skal skrives sammen","Du har skrevet et sammensat ord i to ord.<br>\n<br>\nFx <i>De havde spist for inden → De havde spist forinden</i>"],"@new":["@new","Nyt ord, der sandsynligvis er ok",'Du har skrevet et ord, der ikke findes i ordbogen, men som ser ud til at være rigtigt. Kig på det en ekstra gang for at være sikker på, at du har skrevet det rigtigt<span style="color: #ff0000">.</span>'],"@green":["@green","Ord, der er forkert i sammenhængen","Du har skrevet et korrekt ord, der dog i denne sammenhæng er forkert.<br>\n<br>\nFx <i>I her travlt → I har travlt</i>"],"@proper":["@proper","Ukendt egennavn","Dette ord er et egennavn og er sandsynligvis korrekt. Det findes bare ikke i programmets ordbog. Så du afgør selv, om det er korrekt stavet."],"@abbreviation":["@abbreviation","Ukendt forkortelse","Du har skrevet en forkortelse, som ikke er almindelig kendt. Kig på den igen for at være sikker på, at du har skrevet forkortelsen rigtigt.<br>\n<br>\nFx <i>se</i> <i>kap.</i><i> 5</i>"],"@hyphen-prefix":["@hyphen-prefix","Manglende bindestreg efter forreste orddel i sideordning","Du har undladt at skrive en bindestreg i en sideordning, hvor to ord deler en del af det sidste ord.<br>\n<br>\nFx <i>sommer og vintertøj → sommer- og vintertøj</i>"],"@hyphen-suffix":["@hyphen-suffix","Manglende bindestreg før sidste orddel i sideordning","Du har undladt at skrive en bindestreg i en sideordning, hvor to ord deler en del af det første ord.<br>\n<br>\nFx <i>papkrus og tallerkener → papkrus og -tallerkener</i>"],"@apostrophe":["@apostrophe","Manglende apostrof","Du har undladt at bruge apostrof i forbindelse med bøjning af forkortelser.<br>\n<br>\nFx <i>pc’en,</i> tal som <i>1960’erne</i><br>\n<br>\nEller du mangler apostrof til at markere genitiv efter s, z eller x.<br>\n<br>\nFx <i>Jens</i> → <i>Jens’</i><br>\n<br>\nHusk, at du på dansk ikke må bruge apostrof som genitiv-s. Altså nej til <i>Jensen’</i>. Det hedder <i>Jensens</i>."],"@no-apostrophe":["@no-apostrophe","Overflødig apostrof","Du har brugt apostrof forkert, som fx <i>Jensen’s</i>. Det hedder <i>Jensens.</i>"],"@upper":["@upper","Første bogstav bør være med stort","Du har begyndt din sætning med lille begyndelsesbogstav. Sætninger begynder altid med stort.<br>\n<br>\nFx <i>han er i alaska → Han er i Alaska</i>"],"@lower":["@lower","Første bogstav bør være med småt","Du har skrevet ord med stort begyndelsesbogstav, hvor første bogstav bør skrives med småt.<br>\n<br>\n<i>Fx Hun blev bidt af en Løve → Hun blev bidt af en løve</i>.<br>\n<br>\nMåske er det din mening, at ordet skal fremhæves ved at skrives med stort begyndelsesbogstav?"],"@question":["@question","Manglende spørgsmålstegn","Du har glemt at sætte spørgsmålstegn efter en spørgende sætning.<br>\n<br>\nFx <i>Hvad har du set. → Hvad har du set?</i>"],"@neu":["@neu","Bøjningsfejl - intetkøn","Du har skrevet en forkert bøjningsform af ordet. Ordet burde være bøjet i intetkøn i stedet for fælleskøn.<br>\n<br>\nFx <i>Den</i><i></i> <i>røde hus ved</i> <i>vanden</i><i> →</i><i></i> <i>Det</i><i> røde ved</i> <i>vandet</i>"],"@neu-sc":["@neu-sc","Bøjningsfejl - intetkøn","Du har skrevet en forkert bøjningsform af ordet. Ordet burde være bøjet i intetkøn i stedet for fælleskøn.<br>\n<br>\nFx <i>Huset er</i> <i>rød</i><i> → Huset er</i><i> rødt</i>"],"@utr":["@utr","Bøjningsfejl - fælleskøn","Du har skrevet en forkert bøjningsform af ordet. Ordet burde være bøjet i fælleskøn i stedet for intetkøn.<br>\n<br>\nFx <i>Det</i><i></i> <i>gamle hest i</i> <i>staldet</i><i> →</i> <i>Den</i><i></i> <i>gamle hest i</i> <i>stalden</i>"],"@utr-sc":["@utr-sc","Bøjningsfejl – fælleskøn","Du har skrevet en forkert bøjningsform af ordet. Ordet burde være bøjet i fælleskøn i stedet for intetkøn.<br>\n<br>\nFx <i>Hesten er</i> <i>gammelt</i><i> → Hesten er</i> <i>gammel</i>"],"@pl":["@pl","Bøjningsfejl – ental/flertal","Du har skrevet en forkert bøjningsform af ordet. Du har brugt ental i stedet for flertal.<br>\n<br>\nFx <i>mange</i> <i>hest</i><i> →</i><i> mange</i> <i>heste</i>"],"@pl-sc":["@pl-sc","Bøjningsfejl – ental/flertal","Du har skrevet en forkert bøjningsform af ordet. Du har brugt flertal i stedet for ental.<br>\n<br>\nFx <i>hestene er</i> <i>gammel</i><i> →</i><i> hestene er</i> <i>gamle</i>"],"@sg":["@sg","Bøjningsfejl – ental/flertal","Du har skrevet en forkert bøjningsform af ordet. Du har brugt flertal i stedet for ental.<br>\n<br>\nFx <i>en ung</i> <i>lærere</i><i> →</i><i> en ung</i> <i>lærer</i>"],"@sg-sc":["@sg-sc","Bøjningsfejl – ental/flertal","Du har skrevet en forkert bøjningsform af ordet. Du har brugt flertal i stedet for ental.<br>\n<br>\nFx <i>huset er</i> <i>store</i><i> → huset er</i> <i>stort</i>"],"@idf":["@idf","Bøjningsfejl – bestemt/ubestemt","Du har skrevet en forkert bøjningsform af ordet. Du har brugt ubestemt form i stedet for bestemt form.<br>\n<br>\nFx <i>et</i> <i>røde</i><i> æble → et</i><i></i> <i>rødt</i><i> æble</i>"],"@idf-sc":["@idf-sc","Bøjningsfejl – bestemt/ubestemt","Du har skrevet en forkert bøjningsform af ordet. Du har Du har brugt ubestemt form i stedet for bestemt form.<br>\n<br>\nFx <i>huset er</i> <i>gamle</i><i> → huset er</i> <i>gammelt</i>"],"@idf-pl":["@idf-pl","Bøjningsfejl – bestemt/ubestemt","Du har skrevet en forkert bøjningsform af ordet. Du har brugt bestemt form i stedet for ubestemt form.<br>\n<br>\nFx <i>mange</i> <i>helten</i><i></i> <i>i film → mange</i> <i>helte</i><i> i film</i>"],"@def":["@def","Bøjningsfejl – bestemt/ubestemt","Du har skrevet en forkert bøjningsform af ordet. Du har brugt ubestemt form i stedet for bestemt form.<br>\n<br>\nFx <i>hele</i> <i>skole</i><i> → hele</i> <i>skolen</i>"],"@vfin":["@vfin","Bøjningsfejl – navneform/nutidsform","Du har skrevet en forkert bøjningsform af ordet. Du har brugt navneform (uden -r) i stedet for nutidsform ( med -r).<br>\n<br>\nFx <i>han</i> <i>høre</i><i> aldrig efter → han</i> <i>hører</i><i> aldrig efter</i>"],"@inf":["@inf","Bøjningsfejl – navneform/nutidsform","Du har skrevet en forkert bøjningsform af ordet. Du har brugt nutidsform (med -r) i stedet for navneform (uden -r).<br>\n<br>\nFx <i>Han begyndte at</i> <i>hører</i><i></i> <i>efter → Han begyndte at</i> <i>høre</i><i></i> <i>efter</i>"],"@impf":["@impf","Bøjningsfejl - datidsform","Du har skrevet en forkert bøjningsform af ordet. Du har brugt en forkert datidsform.<br>\n<br>\nFx <i>vi sad og</i> <i>snakket</i><i> →</i><i> vi sad og</i> <i>snakkede</i>"],"@pcp2-akt":["@pcp2-akt","Bøjningsfejl - tillægsform","Du har skrevet en forkert bøjningsform af ordet. Måske har du glemt et –t.<br>\n<br>\nFx <i>Han har også</i> <i>spille</i><i> på holdet. → Han har også</i> <i>spillet</i><i></i> <i>på holdet.</i>"],"@pas":["@pas","Bøjningsfejl – passiv","Du har skrevet en forkert bøjningsform af ordet. Verbet skal være i passiv.<br>\n<br>\nFx <i>Hammeren</i> <i>bruger</i><i> til mange ting → Hammeren</i> <i>bruges</i><i> til mange ting</i>"],"@ene":["@ene","Forveksling af -ene/-ende","Du har forvekslet to ord, der lyder ens, men som betyder noget meget forskelligt.<br>\n<br>\nFx <i>Husende</i><i> var smukke →</i> <i>Husene</i><i> var smukke</i><br>\n<br>\n’Husene’ er den mest almindelige bestemte flertalsform for navneord, mens ’Husende’ er en tillægsform, der udtrykker processer og egenskaber."],"@ende":["@ende","Forveksling af -ene/-ende","Du har forvekslet to ord, der lyder ens, men som betyder noget meget forskelligt.<br>\n<br>\nFx <i>Han kom</i> <i>løbene</i><i></i> <i>ned ad gaden. → Han kom</i> <i>løbende</i><i> ned ad gaden.</i><br>\n<br>\n’løbene’ er den mest almindelige bestemte flertalsform for navneord, mens ’løbende’ er en tillægsform, der udtrykker processer og egenskaber."],"@nom":["@nom","Bøjningsfejl – stedord og kasus","Du har brugt et stedord med forkert kasus (fald).<br>\n<br>\nFx <i>Dem</i><i></i> <i>kommer i morgen →</i> <i>De</i><i> kommer i morgen</i>"],"@acc":["@acc","Bøjningsfejl – stedord og kasus","Du har brugt et stedord med forkert kasus (fald).<br>\n<br>\nFx <i>Jeg har talt med</i> <i>hun</i><i> →</i><i> Jeg har talt med</i> <i>hende</i>"],"@gen":["@gen","Manglende markering af ejefald.","Du har glemt at markere ejefald (genitiv) med et -s.<br>\n<br>\nFx <i>bogen</i><i> titel →</i> <i>bogens</i><i> titel</i>"],"@adv":["@adv","Manglende -t i biord","Du har undladt et -t i biord<i>.</i><br>\n<br>\nFx <i>han er</i> <i>enorm</i><i> træt → han er</i> <i>enorm</i><i>t træt</i>"],"@nil":["@nil","Overflødigt ord","Du har anvendt et overflødigt ord.<br>\n<br>\nFx <i>Han gad ikke</i> <i>at</i><i> lege. → Han gad ikke lege.</i>"],"@insert":["@insert","Manglende ord","Du mangler at skrive et ord. Indsæt selv det manglende ord.<br>\n<br>\nFx <i>Han begyndte råbe. → Han begyndte</i> <i>at</i><i></i> <i>råbe.</i>"],"@sentsplit":["@sentsplit","Manglende punktum eller andet tegn","Du mangler at sætte punktum eller evt. komma.<br>\n<br>\nFx <i>Han kommer ikke han er syg. → Han kommer ikke</i><i>. Han</i><i> er syg</i>."]};
/*
 * Copyright 2016-2019 GrammarSoft ApS <info@grammarsoft.com> at https://grammarsoft.com/
 * All Rights Reserved
 * Linguistic backend by Eckhard Bick <eckhard.bick@gmail.com>
 * Frontend by Tino Didriksen <mail@tinodidriksen.com>
 */
"use strict";if(tinymce){tinymce.PluginManager.add("placeholder",function(a){a.on("init",function(){var c=new b;e();tinymce.DOM.bind(c.el,"click",d);a.on("focus",d);a.on("blur",e);a.on("change",e);function d(){c.hide();tinyMCE.execCommand("mceFocus",false,a)}function e(){if(a.getContent()==""){c.show()}else{c.hide()}}});var b=function(){this.text=a.getElement().getAttribute("placeholder");this.contentAreaContainer=a.getContentAreaContainer();tinymce.DOM.setStyle(this.contentAreaContainer,"position","relative");var c={id:"placeholder",style:{position:"absolute",top:"10px",left:"10px",color:"#777",padding:"1%",width:"98%",overflow:"hidden","text-align":"center","font-size":"200%"}};this.el=tinymce.DOM.add(this.contentAreaContainer,"label",c,this.text)};b.prototype.hide=function(){tinymce.DOM.setStyle(this.el,"display","none")};b.prototype.show=function(){tinymce.DOM.setStyle(this.el,"display","")}})}function select_text(c){c.focus();if(document.body.createTextRange){var a=c.offsetParent;while(a.offsetParent){a=a.offsetParent}var b=a.createTextRange();b.moveToElementText(c);b.select()}else{if(window.getSelection){var f=c.ownerDocument;var e=f.defaultView;var d=e.getSelection();var b=f.createRange();b.selectNodeContents(c);d.removeAllRanges();d.addRange(b)}}}jQuery.fn.selectText=function(){select_text(this[0]);return this};Array.prototype.unique=function(){var b=[];for(var a=0;a<this.length;++a){if(b.indexOf(this[a])==-1){b.push(this[a])}}return b};var Defs={CAP_ADMIN:(1<<0),CAP_COMMA:(1<<1),CAP_DANPROOF:(1<<2),CAP_AKUTUTOR:(1<<3),CAP_COMMA_TRIAL:(1<<4),CAP_DANPROOF_TRIAL:(1<<5),CAP_AKUTUTOR_TRIAL:(1<<6),OPT_COMMA_LEVEL_1:(1<<0),OPT_COMMA_LEVEL_2:(1<<1),OPT_COMMA_LEVEL_3:(1<<2),OPT_COMMA_GREEN:(1<<3),OPT_COMMA_MAYBE:(1<<4),OPT_COMMA_COLOR:(1<<5),OPT_DP_ONLY_CONFIDENT:(1<<0),OPT_DP_IGNORE_NAMES:(1<<1),OPT_DP_IGNORE_COMP:(1<<2),OPT_DP_IGNORE_ABBR:(1<<3),OPT_DP_IGNORE_OTHER:(1<<4),OPT_DP_IGNORE_MAJ:(1<<5),OPT_DP_COLOR:(1<<6),OPT_DP_USE_DICT:(1<<7),MAX_SESSIONS:5,MAX_RQ_SIZE:4096,"comma-commercial":"Kommaforslag Erhverv","comma-private":"Kommaforslag Privat","comma-student":"Kommaforslag Studerende","danproof-commercial":"RetMig Erhverv","danproof-private":"RetMig Privat","danproof-student":"RetMig Studerende","akututor-clinic":"Akututor Klinik","akututor-student":"Akututor Studerende",};Defs.OPT_DP_IGNORE_UNKNOWN=Defs.OPT_DP_IGNORE_NAMES|Defs.OPT_DP_IGNORE_COMP|Defs.OPT_DP_IGNORE_ABBR|Defs.OPT_DP_IGNORE_OTHER;var last_result="";var to_send=[];var to_send_i=0;var ts_xhr=null;var ts_slow=null;var ts_fail=0;var eht_timer=null;var eht_prevent=false;var cookie_hmac=null;var text_nodes=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","CANVAS","DD","DIV","DL","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TD","TH","UL","VIDEO"];var tnjq=null;var itjq="B,BIG,I,SMALL,TT,ABBR,ACRONYM,CITE,CODE,DFN,EM,KBD,STRONG,SAMP,TIME,VAR,A,BDO,Q,SPAN,SUB,SUP,LABEL";var ccomma=null;var android=false;var iOS=false;function ga_log(a,b,c){if(!ga||typeof ga==="undefined"){return}ga("send","event",a,b,c)}function send_post(a,b){if(typeof b==="undefined"||!b){b={}}return $.ajax({url:a,type:"POST",dataType:"json",headers:{HMAC:cookie_hmac.sess_id},data:b,})}function log_click(a){$.post("./callback.php?a=click",{data:JSON.stringify(a)})}function log_error(a){$.post("./callback.php?a=error",{data:JSON.stringify(a)})}function log_warning(a){$.post("./callback.php?a=warning",{data:JSON.stringify(a)})}function is_upper(a){return(a===a.toUpperCase()&&a!==a.toLowerCase())}function uc_first(a){return a.substr(0,1).toUpperCase()+a.substr(1)}function escHTML(b){var a=b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");return a}function decHTML(b){var a=b.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&amp;/g,"&");return a}function sortByLocale(d,c){return d.toUpperCase().localeCompare(c.toUpperCase())}function haveLocalStorage(){try{var c=window.localStorage;var a="LocalStorageTest";c.setItem(a,a);c.removeItem(a)}catch(b){return false}return true}function skipNonText(c,a){var b=true;while(b){b=false;while(/^\s$/.test(c.charAt(a))){++a}while(a<c.length&&c.charAt(a)==="<"){while(a<c.length&&c.charAt(a)!==">"){while(a<c.length&&c.charAt(a)==='"'){++a;while(a<c.length&&c.charAt(a)!=='"'){++a}++a}while(a<c.length&&c.charAt(a)==="'"){++a;while(a<c.length&&c.charAt(a)!=="'"){++a}++a}if(a<c.length&&c.charAt(a)!==">"){++a}}b=true;++a}while(a<c.length&&c.charAt(a)==="&"){while(a<c.length&&c.charAt(a)!==";"){++a}b=true;++a}while(/^\s$/.test(c.charAt(a))){++a}}return a}function check_slow(){$("#working").find("span").text("arbejder stadig, vent lidt");ts_slow=setTimeout(check_slow_2,5000)}function check_slow_2(){$("#working").find("span").text("er du sikker på at du har forbindelse?");ts_slow=setTimeout(check_slow_3,5000)}function check_slow_3(){$("#working").find("span").text("opgiver om 5 sekunder");ts_slow=setTimeout(check_slow_4,5000)}function check_slow_4(){last_result="";to_send=[];to_send_i=0;ccomma=null;ts_slow=null;checkDone();if(ts_xhr){ts_xhr.abort()}ts_xhr=null}function cleanEditorContent(){var a={A:/^(href)$/i,IMG:/^(src|width|height|hspace|vspace)$/i};$(tinyMCE.activeEditor.getBody()).find("*").removeClass().each(function(){var b=this.attributes;var c=b.length;while(c--){if(a.hasOwnProperty(this.nodeName)&&a[this.nodeName].test(b[c].name)){continue}this.removeAttributeNode(b[c])}})}function prepEditorContent(b){b.find('[class*="mce-"]').each(function(){if($.trim($(this).text()).length===0){$(this).remove()}});b.find("br").each(function(){if(this.parentNode&&this.parentNode.lastChild==this){this.parentNode.removeChild(this)}});var a=b.html();if(a.indexOf("&nbsp;")!=-1||a.indexOf("  ")!=-1){b.html(a.replace(/&nbsp;/g," ").replace(/ +/g," "))}b.removeAttr("contenteditable");b.css("overflow-y","scroll");b.find("div.unwrap").each(function(){$(this).children().unwrap()})}function findTextNodes(a){var b=[],d=/\S/;if(!$.isArray(a)){a=[a]}function e(g){if(g.nodeType==3){if(d.test(g.nodeValue)){b.push(g)}}else{for(var f=0;f<g.childNodes.length;++f){e(g.childNodes[f])}}}for(var c=0;c<a.length;++c){e(a[c])}return b}function checkAll(){check(this)}function danproof_login(a){$.post("./callback.php?a=login",{u:a}).success(function(){window.location="./"}).fail(function(){alert("Kunne ikke logge ind - er du sikker på at du har adgang til dette værktøj?")})}function danproof_login_popup(a){$.post("./callback.php?a=login",{u:a}).success(function(){window.location=window.location.href.replace("popup=2","popup=3")}).fail(function(){alert("Kunne ikke logge ind - er du sikker på at du har adgang til dette værktøj?")})}function danproof_logout(){send_post("./callback.php?a=logout").success(function(){window.location="./";window.location.reload(true)}).fail(function(){alert("Kunne ikke logge ud - er du sikker på at du har adgang til dette værktøj?")})}function logout_other(b){var a=$(b).closest("tr");send_post("./callback.php?a=logout-other",{s:a.attr("data-id")}).success(function(d){a.fadeOut();var c=cookie_hmac.sess_caps;cookie_hmac=Cookies.getJSON("comma-hmac");if(c!=cookie_hmac.sess_caps){$("#profile").on("hide.bs.modal",function(){window.location="./";window.location.reload(true)})}}).fail(function(){alert("Kunne ikke logge ud - er du sikker på at du har adgang til dette værktøj?")})}function profile_open(){send_post("./callback.php?a=get-profile").success(function(f){if(!f.hasOwnProperty("a")||f.a!=="get-profile"){return}if(!f.hasOwnProperty("profile")){alert("Kunne ikke åbne din profil - er du sikker på at du har adgang til dette værktøj?");return}var g=$("#profile");var d="";d+="<h3>Konto</h3>";d+="<b>Brugernavn</b>: "+escHTML(f.profile.u)+"<br>";d+='<b>Password</b>: <a href="https://gramtrans.com/wp-admin/profile.php" target="_blank">Skift password</a>';if(f.profile.a.length){d+="<h3>PayPal Abonnementer</h3>";d+='<div class="table-responsive"><table class="table table-striped">';for(var c=0;c<f.profile.a.length;++c){var b=f.profile.a[c];d+='<tr><td class="small">';d+="<b>Type</b>: "+escHTML(Defs[b.acl_which])+"<br>";d+="<b>ID</b>: "+escHTML(b.subscr_id)+"<br>";d+="<b>Løbetid</b>: "+(new Date(b.acl_start*1000).toLocaleDateString("da-DK"))+" → "+(new Date(b.acl_stop*1000).toLocaleDateString("da-DK"))+"<br>";d+='<b>Faktura</b>: <a href="./receipt?id='+escHTML(b.txn_id)+'">HTML</a>, <a href="./receipt?id='+escHTML(b.txn_id)+'&amp;fmt=pdf">PDF</a>';d+="</td><td>";d+='<a class="btn btn-warning" href="https://www.paypal.com/myaccount/autopay" target="_blank">Administrer</a>';d+="</td></tr>"}d+="</table></div>"}if(f.profile.s.length){d+="<h3>Forbundne Enheder</h3>";d+='<div class="table-responsive"><table class="table table-striped">';for(var c=0;c<f.profile.s.length;++c){var e=f.profile.s[c];d+='<tr data-id="'+escHTML(e.sess_id)+'"><td class="small">';d+="<b>Enhed</b>: "+escHTML(e.sess_ua)+"<br>";d+="<b>IP</b>: "+e.sess_ip+"<br>";d+="<b>Sidst aktiv</b>: "+(new Date(e.sess_seen*1000).toLocaleString("da-DK"));d+="</td><td>";if(e.sess_id!==cookie_hmac.sess_id){d+='<button class="btn btn-warning" onclick="logout_other(this);">Fjern enhed</button>'}d+="</td></tr>"}d+="</table></div>"}g.find("h4.modal-title").text("Profil for "+f.profile.u);g.find("div.modal-body").html(d);g.modal("show")}).fail(function(){alert("Kunne ikke åbne din profil - er du sikker på at du har adgang til dette værktøj?")})}function profile_close(){$("#profile").modal("hide")}function redeem_handler(a){if(!a.hasOwnProperty("g")&&!a.hasOwnProperty("r")){alert("Svaret fra serveren var tomt");return}if(a.hasOwnProperty("r")){alert(a.r);return}if(a.hasOwnProperty("g")){redeem_close();alert(a.g);return}}function redeem_do(){var d=$("#redeem_consent").prop("checked");var a=$.trim($("#redeem_email").val());var c=$.trim($("#redeem_email2").val());var b=$.trim($("#redeem_code").val().replace(/[^a-zA-Z0-9]+/g,""));if(!d){alert("Du skal acceptere vilkårene før du kan gå videre.");return}if(a.length==0){alert("Mangler en gyldig email-addresse!");return}if(!/^.+@.+?\..+$/.test(a)){alert(a+" er ikke en gyldig email-addresse!");return}if(a!==c){alert("Email-addresserne skal være ens!");return}if(b.length==0){alert("Mangler en gyldig kode!");return}if(b.length!=15){alert(b+" er ikke en gyldig kode!");return}$.post("./callback.php?a=redeem",{email:a,code:b}).success(redeem_handler).fail(function(){alert("Kunne ikke indløse værdikoden. Er du sikker på den er gyldig?")})}function redeem_open(){if(window.location.hash&&/redeem=[-A-Za-z0-9]+/.test(window.location.hash)){var a=window.location.hash.replace(/^.*redeem=([-A-Za-z0-9]+).*$/g,"$1");$("#redeem_code").val(a)}$("#redeem").modal("show")}function redeem_close(){$("#redeem").modal("hide")}function paypal_close(a){$(a).closest("form").find(".popover").remove()}function paypal_submit(b){if(!$(b).closest("form").find("#consent").first().prop("checked")){alert("Du skal acceptere vilkårene før du kan gå videre.");return false}var a=$(b).closest("form").find("#school");if(a.length==0){return true}var c=$.trim(a.val());if(c.length>=2){return true}alert("Feltet skal udfyldes med en navnet på en eksisterende institution.");return false}function shared_init(){cookie_hmac=Cookies.getJSON("comma-hmac");if(typeof cookie_hmac==="undefined"){cookie_hmac={sess_id:"",sess_caps:0,cnt:0}}$('input[name="item_number"]').each(function(){var a="";if($(this).val().indexOf("-student-")!==-1){a+='<div class="form-group"><label class="control-label" for="school">Hvilken uddannelsesinstitution / skole går du på?</label><input name="on1" type="hidden" value="Institution"><input name="os1" id="school" class="form-control"></div>'}a+='<div class="checkbox"><label><input name="on0" type="hidden" value="Consent"><input name="os0" id="consent" type="checkbox"> Marker at du har læst, forstået og accepteret vores <a href="./terms" target="_blank">anvendelsesvilkår</a></label></div><div class="form-group"><button class="btn btn-default" onclick="paypal_close(this); return false;">Luk</button> <button type="submit" class="btn btn-primary" onclick="return paypal_submit(this);">Videre</button></div>';$(this).closest("form").find("button").off().click(function(){$(this).popover({html:true,content:a,placement:"top",});$(this).popover("show");return false})})}function shared_hook(){if(window.location.hash){if(window.location.hash.indexOf("redeem")!=-1){setTimeout(redeem_open,500)}}}function sanitize_result(a){for(var d=0;d<Defs.MAX_RQ_SIZE;++d){var f="</s"+d+">";var e="<s"+(d+1)+">";var c=a.indexOf(f);var b=a.indexOf(e);if(c!==-1&&b!==-1&&b<c){a=a.replace(new RegExp("("+e+")((.|\\s)*?"+f+")","g"),"$2\n\n$1\n")}}a=a.replace(/<s\d+>[\s\n]*<\/s\d+>/g,"");a=a.replace(/^[^]*?(<s\d+>)/,"$1");a=a.replace(/(\n<\/s\d+>)[^]*?(<s\d+>\n)/g,"$1\n\n$2");return a}function renumerate_editor(){var c=$(tinyMCE.activeEditor.getBody());var e=$(findTextNodes(c.get(0))).closest(tnjq).get();for(var a=0;a<e.length;++a){var d=$(e[a]);var b=$.trim(d.html().replace(/<br\/?\s*>/g,"\n").replace(/<[^>]+>/g,""));if(!b){continue}var f=a+1;d.attr("id","s"+f)}}function transfer_document(){commaIgnoreAll();$(tinyMCE.activeEditor.getBody()).focus();tinyMCE.activeEditor.execCommand("selectAll");if(!iOS){tinyMCE.activeEditor.execCommand("copy")}ga_log("ui","transfer");var a=$("#transfer");a.find("input").val($(tinyMCE.activeEditor.getBody()).html());a.get(0).submit()}function pprest_check_event(){var a=$("#pprest-reply").html();$("#pprest-reply").html("… checker …");$.post("./callback.php?a=pprest-check-event",{aid:pprest_aid,pid:pprest_pid}).success(function(b){if(b.hasOwnProperty("receipt")){$("#pprest-reply").html('<h2>PayPal Betaling Gennemført</h2><p>Du skulle gerne have modtaget en email med nedenstående indhold.</p><blockquote class="email">'+b.receipt+"</blockquote>");clearInterval(pprest_int)}else{$("#pprest-reply").html(a)}}).fail(function(){$("#pprest-reply").html(a);alert("Kunne ikke checke PayPals status!")})}
/*
 * Copyright 2016 GrammarSoft ApS <info@grammarsoft.com> at https://grammarsoft.com/
 * All Rights Reserved
 * Linguistic backend by Eckhard Bick <eckhard.bick@gmail.com>
 * Frontend by Tino Didriksen <mail@tinodidriksen.com>
 */
"use strict";var opt_seen=false;var opt_onlyConfident=false;var opt_ignUnknown=false;var opt_ignUNames=false;var opt_ignUComp=false;var opt_ignUAbbr=false;var opt_ignUOther=false;var opt_ignMaj=false;var opt_color=false;var opt_useDictionary=true;var opt_storage=false;var opt_dictionary=[];var live_dictionary={};var g_access={hmac:"",sessionid:""};function onResizeHandler(){var b=$(".mce-edit-area").find("iframe").first();$(".mce-tinymce").css("border","0");$(".mce-edit-area").height(100);b.height(100);var a=$("#container").innerHeight();a-=$("#headbar").outerHeight();a-=$("#footbar").outerHeight();a-=$("#ed-head").outerHeight();a-=$("#ed-foot").outerHeight();a-=40;a-=$(".mce-menubar.mce-toolbar").outerHeight();if($(".mce-toolbar-grp:visible").length){a-=$(".mce-toolbar-grp").outerHeight()}a-=$(".mce-statusbar").outerHeight();a-=1;$(".mce-edit-area").height(a);b.height(a);if(b.height()!=a){var a=b.height();$(".mce-edit-area").height(a);b.parent().height(a)}if(tinyMCE&&tinyMCE.activeEditor){$(tinyMCE.activeEditor.getBody()).css("min-height",a-20)}editorHasText()}function onResize(){setTimeout(onResizeHandler,500);setTimeout(onResizeHandler,1000)}function showTypes(){$("#dg_types").modal()}function showInput(){$("#do_input_text").val(ccomma.text());$("#dg_input").modal()}$(function(){opt_storage=haveLocalStorage();if(opt_storage&&localStorage.getItem("opt_seen")){opt_seen=parseInt(localStorage.getItem("opt_seen"))==1;opt_onlyConfident=parseInt(localStorage.getItem("opt_onlyConfident"))==1;opt_ignUnknown=parseInt(localStorage.getItem("opt_ignUnknown"))==1;opt_ignUNames=opt_ignUnknown||parseInt(localStorage.getItem("opt_ignUNames"))==1;opt_ignUComp=opt_ignUnknown||parseInt(localStorage.getItem("opt_ignUComp"))==1;opt_ignUAbbr=opt_ignUnknown||parseInt(localStorage.getItem("opt_ignUAbbr"))==1;opt_ignUOther=opt_ignUnknown||parseInt(localStorage.getItem("opt_ignUOther"))==1;opt_ignMaj=parseInt(localStorage.getItem("opt_ignMaj"))==1;opt_color=parseInt(localStorage.getItem("opt_color"))==1;opt_useDictionary=parseInt(localStorage.getItem("opt_useDictionary"))==1;opt_dictionary=(localStorage.getItem("opt_dictionary")||"").split("\t");for(var b=0;b<opt_dictionary.length;++b){if(!opt_dictionary[b]){continue}addToDictionary_helper(opt_dictionary[b])}}tnjq=text_nodes.join(",");tinymce.init({selector:"textarea",menubar:false,statusbar:false,plugins:["searchreplace","paste","placeholder"],browser_spellcheck:false,language:"da",entity_encoding:"raw",language_url:"./static/da.js",content_css:"./static/inline.css?v=ecf4ceb9",setup:function(h){h.on("keyup paste change",function(){if(eht_prevent){return}if($("#dg_input").hasClass("in")){return}if(eht_timer){clearTimeout(eht_timer)}eht_timer=setTimeout(editorHasText,250)});h.on("paste",function(){commaIgnoreAll();setTimeout(cleanEditorContent,500);ga_log("ui","paste")});h.on("undo",function(){commaIgnoreAll();setTimeout(cleanEditorContent,500)});h.on("postRender",function(){var i=$("iframe");$("#working").show().offset(i.offset()).width(i.width()).height(i.height()).hide();$(".mce-toolbar-grp").hide();onResize();if(tinymce&&tinymce.i18n&&tinymce.i18n.data&&tinymce.i18n.data.da){tinymce.i18n.data.da.Blocks="Afsnit";tinymce.i18n.data.da.Inline="Skrifttype"}})}});var g=$("#dg_types").find(".modal-body");for(var c in ctypes){if(!ctypes.hasOwnProperty(c)){continue}var e=ctypes[c][0];e=e.replace(/<\/h3>.*?<h3>/g,"</h3><h3>");e=e.replace(/^(<h3>.+<\/h3>).*?$/,"$1");e=e.replace(/h3/g,"h4");var d='<div class="row"><div class="col-md-4" title="'+c+'">'+e+"Niveau "+ctypes[c][1]+'</div><div class="col-md-8">'+ctypes[c][0]+"<br><br></div></div>";g.append(d)}checkDone();$("#btn-check,#btn-correct-all,#btn-wrong-all,#btn-copy,#btn-erase,#btn-close").addClass("disabled");$("#btn-check").click(function(){checkAll();ga_log("ui","check")});$("#btn-correct-all").click(function(){if($(this).hasClass("disabled")){return}ga_log("ui","correct-all-yellow");log_click("correct-all-yellow");$(tinyMCE.activeEditor.getBody()).find("span.comma-yellow").each(function(){ccomma=$(this);commaYellow()})});$("#btn-erase").click(function(){$(tinyMCE.activeEditor.getBody()).text("");editorHasText();ga_log("ui","erase")});$("#btn-close").click(function(){commaIgnoreAll();ga_log("ui","close")});$("#btn-copy").click(function(){commaIgnoreAll();$(tinyMCE.activeEditor.getBody()).focus();tinyMCE.activeEditor.execCommand("selectAll");tinyMCE.activeEditor.execCommand("copy");ga_log("ui","copy")});$("#btn-transfer").click(transfer_document);$('[data-toggle="popover"]').popover();$("#btn-options").on("shown.bs.popover",optionsOpen).on("hide.bs.popover",optionsClose).click(function(){$(this).popover("toggle")});if(!opt_seen){$("#btn-options").popover("show")}$("#dg_input").on("shown.bs.modal",function(){$("#do_input_text").focus()});$("#do_input_one").click(function(){var h=$("#do_input_text").val();ga_log("comma","input",h);log_click({input:ccomma.attr("data-types"),w:ccomma.text(),r:h});commaDo(h)});$(window).on("resize",onResize);$(window).on("beforeunload",function(h){if(tinyMCE&&tinyMCE.activeEditor&&$(tinyMCE.activeEditor.getBody()).find("span.comma").length){var i="Er du sikker på at du vil lukke siden?";h.returnValue=i;return i}});$("#warning").hide();var a=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);if(a&&parseInt(a[1])<537){var f='Din browser er for gammel. Du bør opgraderer til en nyere <a href="https://play.google.com/store/apps/details?id=com.android.chrome">Chrome</a> eller <a href="https://play.google.com/store/apps/details?id=org.mozilla.firefox">Firefox</a>.';$("#warning").html(f).show();alert(f.replace(/<[^>]+>/g,""))}iOS=window.navigator.userAgent.indexOf("Apple")!==-1&&(window.navigator.userAgent.indexOf("iPad")!==-1||window.navigator.userAgent.indexOf("iPhone")!==-1||window.navigator.userAgent.indexOf("iPod")!==-1);if(iOS){$("#btn-copy").find(".text").text("Vælg alt tekst i dokumentet")}});function toggleGUIs(){if(!tinyMCE||!tinyMCE.activeEditor){return}var a=tinyMCE.activeEditor.getBody();var b=$(a);if(b.find("span.comma-yellow").length){$("#btn-correct-all").removeClass("disabled")}else{$("#btn-correct-all").addClass("disabled")}if(b.find("span.comma").length){b.removeAttr("contenteditable")}else{$("#btn-close").addClass("disabled");b.attr("contenteditable",true);b.css("overflow-y","");last_result=null}if(a.childNodes.length&&a.textContent.length){$("#btn-check,#btn-copy,#btn-erase").removeClass("disabled");$("#placeholder").hide()}else{$("#btn-check,#btn-copy,#btn-erase").addClass("disabled");$("#placeholder").show()}}function editorHasText(){eht_timer=null;if(!tinyMCE||!tinyMCE.activeEditor||eht_prevent){return}var a=tinyMCE.activeEditor.getBody();toggleGUIs();$(a).find("span.comma").popover("destroy");ccomma=null}function optionsOpen(){$("#opt_onlyConfident").prop("checked",opt_onlyConfident);$("#opt_ignUnknown").prop("checked",opt_ignUnknown);$("#opt_ignUNames").prop("checked",opt_ignUNames);$("#opt_ignUComp").prop("checked",opt_ignUComp);$("#opt_ignUAbbr").prop("checked",opt_ignUAbbr);$("#opt_ignUOther").prop("checked",opt_ignUOther);$("#opt_ignMaj").prop("checked",opt_ignMaj);$("#opt_color").prop("checked",opt_color);$("#opt_useDictionary").prop("checked",opt_useDictionary);$("#opt_ignUNames,#opt_ignUComp,#opt_ignUAbbr,#opt_ignUOther").off().click(function(){$("#opt_ignUnknown").prop("checked",$("#opt_ignUNames").prop("checked")&&$("#opt_ignUComp").prop("checked")&&$("#opt_ignUAbbr").prop("checked")&&$("#opt_ignUOther").prop("checked"))});$("#opt_ignUnknown").off().click(function(){$("#opt_ignUNames,#opt_ignUComp,#opt_ignUAbbr,#opt_ignUOther").prop("checked",$(this).prop("checked"))});$("#btn-options-close").off().click(function(){$("#btn-options").popover("hide")})}function optionsClose(){if($("#btn-options").hasClass("disabled")){return}opt_onlyConfident=$("#opt_onlyConfident").prop("checked");opt_ignUnknown=$("#opt_ignUnknown").prop("checked");opt_ignUNames=opt_ignUnknown||$("#opt_ignUNames").prop("checked");opt_ignUComp=opt_ignUnknown||$("#opt_ignUComp").prop("checked");opt_ignUAbbr=opt_ignUnknown||$("#opt_ignUAbbr").prop("checked");opt_ignUOther=opt_ignUnknown||$("#opt_ignUOther").prop("checked");opt_ignMaj=$("#opt_ignMaj").prop("checked");opt_color=$("#opt_color").prop("checked");opt_useDictionary=$("#opt_useDictionary").prop("checked");if(opt_storage){localStorage.setItem("opt_seen",1);localStorage.setItem("opt_onlyConfident",opt_onlyConfident?1:0);localStorage.setItem("opt_ignUnknown",opt_ignUnknown?1:0);localStorage.setItem("opt_ignUNames",opt_ignUNames?1:0);localStorage.setItem("opt_ignUComp",opt_ignUComp?1:0);localStorage.setItem("opt_ignUAbbr",opt_ignUAbbr?1:0);localStorage.setItem("opt_ignUOther",opt_ignUOther?1:0);localStorage.setItem("opt_ignMaj",opt_ignMaj?1:0);localStorage.setItem("opt_color",opt_color?1:0);localStorage.setItem("opt_useDictionary",opt_useDictionary?1:0)}if(last_result){$("#btn-options").addClass("disabled");commaIgnoreAll();var a=last_result;parseCommas({c:last_result});last_result=a}else{editorHasText()}ga_log("options","close","["+opt_onlyConfident+","+opt_ignUnknown+","+opt_ignUNames+","+opt_ignUComp+","+opt_ignUAbbr+","+opt_ignUOther+","+opt_ignMaj+","+opt_color+","+opt_useDictionary+"]")}var ude_template='<div class="ud-entry col-sm-6"><div class="input-group input-group-sm"><input type="text" value="{ENTRY}" class="form-control" placeholder="Tilføj nyt ord …"><span class="input-group-btn"><button type="button" class="btn btn-warning btn-sm"><span class="glyphicon glyphicon-pencil"></span></button><button type="button" class="btn btn-danger btn-sm"><span class="glyphicon glyphicon-remove"></span></button></span></div></div>';var ude_focus=null;function UDE_Save(){live_dictionary={};opt_dictionary=[];$("#do_userdict_entries").find("input").each(function(){var b=$.trim($(this).val());$(this).attr("data-entry",b);if(b&&!isInDictionary(b)){addToDictionary_helper(b);opt_dictionary.push(b)}});var a=opt_dictionary.join("\t").replace(/^\s+/g,"").replace(/\s+$/g,"");localStorage.setItem("opt_dictionary",a)}function UDE_Change(){var a=$.trim($(this).val());if(a!=$(this).attr("data-entry")){if(!$(this).attr("data-entry")){$("#do_userdict_entries").append(ude_template.replace("{ENTRY}",""));UDE_Reflow()}UDE_Save()}}function UDE_Focus(){ude_focus=this;$(this).parent().find(".glyphicon-pencil").removeClass("glyphicon-pencil").addClass("glyphicon-ok")}function UDE_Blur(){$("#do_userdict_entries").find(".glyphicon-ok").removeClass("glyphicon-ok").addClass("glyphicon-pencil")}function UDE_Edit(){var a=$(this).closest("div").find("input");if(ude_focus==a.get(0)){ude_focus=null}else{a.focus()}}function UDE_Delete(){var a=$(this).closest(".ud-entry");if($.trim(a.find("input").val())){ude_focus=null;a.remove();UDE_Save();UDE_Reflow()}}function UDE_Reflow(){ude_focus=null;var e=$("#do_userdict_entries");var b=e.find(".ud-entry").detach();e.html("");var d=null;for(var a=0;a<b.length;++a){if(!d||d.find(".ud-entry").length>=2){d=e.append('<div class="row"></div>').find(".row").last()}$(b[a]).appendTo(d)}e.find("input").off().focus(UDE_Focus).blur(UDE_Blur).change(UDE_Change).each(function(){var c=$.trim($(this).val());$(this).attr("data-entry",c)});e.find(".btn-warning").off().click(UDE_Edit);e.find(".btn-danger").off().click(UDE_Delete);UDE_Blur()}function showUserdictEditor(){$('[data-toggle="popover"]').popover("hide");commaIgnoreAll();var b=$("#dg_userdict");var d=b.find("#do_userdict_entries");d.html("");opt_dictionary.sort(sortByLocale);for(var a=0;a<opt_dictionary.length;++a){if(!opt_dictionary[a]){continue}d.append(ude_template.replace("{ENTRY}",escHTML(opt_dictionary[a])))}d.append(ude_template.replace("{ENTRY}",""));UDE_Reflow();b.modal()}function isInDictionary(b){var a=b.charAt(0);if(!live_dictionary.hasOwnProperty(a)){return false}if(!live_dictionary[a].hasOwnProperty(b)){return false}return true}function addToDictionary_helper(b){var a=b.charAt(0);if(!live_dictionary.hasOwnProperty(a)){live_dictionary[a]={}}live_dictionary[a][b]=true;a=a.toUpperCase();if(!live_dictionary.hasOwnProperty(a)){live_dictionary[a]={}}live_dictionary[a][uc_first(b)]=true;live_dictionary[a][b.toUpperCase()]=true}function addToDictionary(){var c=ccomma.text();if(!isInDictionary(c)){addToDictionary_helper(c);if(opt_storage){opt_dictionary.push(c);var d=opt_dictionary.join("\t").replace(/^\s+/g,"").replace(/\s+$/g,"");localStorage.setItem("opt_dictionary",d)}}var b=$(tinyMCE.activeEditor.getBody());var a=b.find("span.comma-yellow").each(function(){ccomma=$(this);if(ccomma.text()!==c&&ccomma.text().toUpperCase()!==c.toUpperCase()){return}commaYellow()});ga_log("ui","dict-add",c);log_click({"dict-add":c})}function commaPopup(o,h){var q=tinyMCE.activeEditor.getBody();var f=$(q);f.find(".popover").remove();f.find("span.comma").popover("destroy").removeClass("comma-selected");if(!h&&ccomma&&ccomma.get(0)===o){ccomma=null;return}ccomma=$(o);ccomma.focus().addClass("comma-selected");var a=is_upper(ccomma.text());var u=a||is_upper(ccomma.text().charAt(0));var m=ccomma.attr("data-types");if(m.indexOf("@lower")!==-1){a=u=false}var l='<div id="popup">';var t=ccomma.attr("data-sugs").split("\t");for(var o=0;o<t.length;++o){if(t[o].length===0){continue}var k=t[o];if(a){k=k.toUpperCase()}else{if(u){k=uc_first(k)}}l+='<div class="action"><a onclick="window.parent.commaAccept(this);"><span class="icon icon-accept"></span><span>'+escHTML(k)+"</span></a></div>"}if(m.indexOf("@nil")!==-1){l+='<div class="action"><a onclick="window.parent.commaAccept();"><span class="icon icon-discard"></span><span>Fjern ordet</span></a></div>'}if(m.indexOf("@insert")!==-1){l+='<div class="action"><a onclick="window.parent.commaAccept();"><span class="icon icon-accept"></span><span>Indsæt ordet</span></a></div>'}if(ccomma.hasClass("comma-yellow")){l+='<div class="action"><a onclick="window.parent.addToDictionary();"><span class="icon icon-accept"></span><span>Tilføj til ordbogen</span></a></div>'}if(m.indexOf("@question")!==-1){l+='<div class="action"><a onclick="window.parent.commaDiscard();"><span class="icon icon-accept"></span><span>Ok</span></a></div>'}else{l+='<div class="action"><a onclick="window.parent.showInput();"><span class="icon icon-accept"></span><span>Ret selv…</span></a></div>';l+='<div class="action"><a onclick="window.parent.commaDiscard();"><span class="icon icon-discard"></span><span>Ignorer</span></a></div>'}l+="</div>";l+='<div id="explanation">';var n=ccomma.attr("data-types").split(/ /g);var r={};var e=h?2:1;for(var j=0;j<n.length;++j){if(n.length>1&&n[j]==="@error"){continue}var s=ctypes[n[j]]?ctypes[n[j]][e]:(n[j]+" ");s="<p>"+s.replace(/(<\/h\d>)/g,"$1<br><br>").replace(/(<br>\s*)+<br>\s*/g,"</p><p>")+"</p>";r[s]=s.replace(/<p>\s*<\/p>/g,"")}l+=$.map(r,function(b){return b}).join("<hr>");if(!h){l+='<hr><div class="action"><a onclick="window.parent.commaExplain();"><span class="icon icon-explain"></span><span>Udvid forklaringen</span></a></div>'}l+="</div>";var d=null;if(ccomma.offset().left+ccomma.width()<f.width()-100){d=q}var g="auto bottom";if(ccomma.offset().top<300){g="bottom"}ccomma.popover({animation:false,content:l,html:true,placement:g,trigger:"manual",viewport:d,}).on("shown.bs.popover",function(){var b=f.find("div.popover");b.scrollintoview();b.find('a[target="_blank"]').off().on("click",function(){window.open($(this).attr("href"))})});ccomma.popover("show")}function commaInlineClick(){commaPopup(this,false);ga_log("comma","click")}function commaExplain(){commaPopup(ccomma.get(0),true);ga_log("comma","explain",ccomma.attr("data-types"));log_click({explain:ccomma.attr("data-types")})}function commaCreateInline(m,j,u){var l=$(tinyMCE.activeEditor.getBody()).find("#s"+m);if(l.length==0){renumerate_editor();l=$(tinyMCE.activeEditor.getBody()).find("#s"+m)}var o=l.html();var s=/[^\d\wa-zA-ZéÉöÖæÆøØåÅ.,]/ig;var k=/[<>]/;var d="green";var h=u[1].split(/ /g);for(var n=0;n<h.length;++n){if(types_yellow.hasOwnProperty(h[n])){d="yellow"}if(types_red.hasOwnProperty(h[n])){d="red";break}}for(var n=0;n<h.length;++n){if(h[n]==="@green"){d="green"}}if(opt_useDictionary&&d==="yellow"&&isInDictionary(u[0])){if(u[2].length==0){return}d="green"}if(opt_onlyConfident&&d!=="red"){return}if(!u[2]&&/@-?comp(-|\t|$)/.test(u[1])){u[2]=u[0]}if($.inArray("@comp-",h)!==-1){u[0]+=" "}else{if($.inArray("@-comp",h)!==-1){u[0]=" "+u[0]}else{if($.inArray("@comp-:-",h)!==-1){u[0]+=" ";u[2]=u[2].replace(/(\t|$)/g,"‐$1")}}}j=$.trim(j.replace(/\s+/g,"").replace(s,"\ue000"));var e=0;var n=0;for(;n<o.length;++n){n=skipNonText(o,n);for(var b=e;b<j.length&&b<e+10;++b){if(j.charAt(b)===o.charAt(n)||(j.charAt(b)==="\ue000"&&!k.test(o.charAt(n))&&s.test(o.charAt(n)))){e=b;while(e<j.length-1&&j.charAt(e)===o.charAt(n)){++e;n=skipNonText(o,n+1)}break}}if(e>=j.length-1){var g=u[0];if(h[0]!=="@insert"&&g&&g.length){var c=skipNonText(o,n+1);if(o.charAt(c)===g.charAt(0)){if(o.charAt(c-1)===">"){while(c>0&&o.charAt(c)!=="<"){--c}}n=c-2}}break}}var a=u[0];if(o.indexOf(u[0],n)===-1&&o.indexOf(escHTML(u[0]),n)!==-1){u[0]=escHTML(u[0])}if(h[0]!=="@insert"){var c=o.indexOf(u[0],n);var f=o.lastIndexOf("<",c);var r=o.indexOf(">",f);while(c!==-1&&c>f&&c<r){c=o.indexOf(u[0],r+1);f=o.lastIndexOf("<",c);r=o.indexOf(">",f)}if(c!==-1){n=c}}if(o.length>=n+2&&o.charAt(n+1)=="<"&&o.charAt(n+2)=="/"){n=skipNonText(o,n+1)}if($.inArray("@-comp",h)===-1&&$.inArray("@insert",h)===-1&&/\S/.test(o.charAt(n+u[0].length-1))){u[0]=$.trim(u[0])}var t="";if(opt_color){t=" alt"}var q='<span class="comma comma-'+d+t+'" data-types="'+escHTML(u[1])+'" data-sugs="'+escHTML(u[2])+'">'+escHTML(a)+"</span>";if(h[0]==="@insert"){o=o.substr(0,n)+q+" "+o.substr(n)}else{o=o.substr(0,n)+q+o.substr(n+u[0].length)}o=o.replace("&nbsp;"," ").replace(/  +/g," ");l.html(o);$(l).find("span.comma").off().click(commaInlineClick)}function commaDo(a){var e=$(tinyMCE.activeEditor.getBody());e.find(".popover").remove();var d=e.find("span.comma");d.popover("destroy");$("#dg_input").modal("hide");if(!ccomma){return}var f=0;for(var b=0;b<d.length;++b){if(d[b]===ccomma.get(0)){f=b}}ccomma.replaceWith(a);ccomma=null;if(e.find("span.comma").length==0){$("#btn-correct-all,#btn-wrong-all,#btn-close").addClass("disabled");e.attr("contenteditable",true)}else{d=e.find("span.comma");if(f>=d.length){--f}d.eq(f).click()}}function commaAccept(d){if(!ccomma){return}var a="";var b=ccomma.attr("data-types");var c={accept:b,w:ccomma.text()};if(b.indexOf("@nil")!==-1){a=""}else{if(b.indexOf("@insert")!==-1){a=ccomma.text()}else{a=$(d).text();c.r=a}}ga_log("comma","accept",ccomma.attr("data-types"));log_click(c);commaDo(a)}function commaDiscard(){ga_log("comma","discard",ccomma.attr("data-types"));log_click({discard:ccomma.attr("data-types"),w:ccomma.text()});var a=ccomma.attr("data-types");if(a.indexOf("@insert")!==-1){commaDo("")}else{commaDo(ccomma.text())}}function commaYellow(){var b={yellow:ccomma.attr("data-types"),w:ccomma.text()};if(ccomma.attr("data-sugs")){var a=ccomma.attr("data-sugs").split("\t")[0];if(a===ccomma.text()||a.toUpperCase()===ccomma.text().toUpperCase()){b.r=a;commaDo(a)}}else{commaDo(ccomma.text())}ga_log("comma","yellow",ccomma.attr("data-types"));log_click(b)}function parseCommas(m){if(!m.hasOwnProperty("c")){var l=$(tinyMCE.activeEditor.getBody()).html();if(ts_fail<2){++ts_fail;--to_send_i;log_warning({e:"empty",d:m,l:l.length,b:l.substr(0,Defs.MAX_RQ_SIZE)});send_text();return 0}log_error({e:"empty",d:m,l:l.length,b:l.substr(0,Defs.MAX_RQ_SIZE)});alert("Svaret fra serveren var tomt - prøv evt. igen.");return -1}ts_fail=0;m=m.c;m=sanitize_result(m);last_result+=m+"\n\n";var s=$.trim(m.replace(/\n+<\/s>\n+/g,"\n\n")).split(/<\/s\d+>/);for(var v=0;v<s.length;++v){var g=$.trim(s[v]);if(!g){continue}var a=g.split(/\n/);var p=a[0].replace(/^<s(.+)>$/,"$1");var m="";for(var u=1;u<a.length;++u){if(/^<s\d+>$/.test(a[u])){continue}var h=a[u].split(/\t/);h[0]=$.trim(h[0].replace(/(\S)=/g,"$1 "));if(h[0]===""){continue}if(h.length>1){var b=h[1].split(/ /g);var z=[];var d=[];var x=false;var q=false;for(var t=0;t<b.length;++t){if(b[t].indexOf("<R:")===0){var r=b[t].substr(3);r=r.substr(0,r.length-1).replace(/(\S)=/g,"$1 ");if(r===h[0]){continue}d.unshift(r);x=true;continue}if(b[t].indexOf("<AFR:")===0){var r=b[t].substr(5);r=r.substr(0,r.length-1).replace(/(\S)=/g,"$1 ");if(r===h[0]){continue}d.push(r);continue}if(types_only&&Object.keys(types_only).length&&types_only.hasOwnProperty(b[t])){q=true}if(ctypes.hasOwnProperty(b[t])){z.push(b[t])}else{z.push("@unknown-error")}}if(u==a.length-1&&z.length==1&&z[0]==="@sentsplit"){d=[];z=[]}if(!x){d=[]}if(!q){d=[];z=[]}var b=[];for(var t=0;t<z.length;++t){if(z[t]==="@green"){b.push(z[t]);continue}if(opt_onlyConfident&&!types_red.hasOwnProperty(z[t])){continue}if(opt_ignUNames&&z[t]==="@proper"){continue}if(opt_ignUComp&&z[t]==="@new"){continue}if(opt_ignUAbbr&&z[t]==="@abbreviation"){continue}if(opt_ignUOther&&z[t]==="@check!"){continue}if(opt_ignMaj&&(z[t]==="@upper"||z[t]==="@lower")){continue}b.push(z[t])}z=b;if(z.length==0){d=[]}if(d.length){var o=false;for(var y=1;y<d.length;++y){if(d[0].toUpperCase()==d[y].toUpperCase()){o=true;break}}if(!o){d=[d[0]]}d=d.unique();h[2]=d.join("\t")}if(z.length){h[1]=z.join(" ");if(!h[2]||h[2].length===0){h[2]=""}}else{h.pop()}}if(h.length>1){commaCreateInline(p,m,h)}if(h[0]!==","||h.length===1){if(h[0].search(/^[-,.:;?!$*½§£$%&()={}+]$/)===-1){m+=" "}m+=h[0]}}}$("#btn-check,#btn-correct-all,#btn-wrong-all,#btn-options,#btn-close").removeClass("disabled");$("#working").hide();var e=$(tinyMCE.activeEditor.getBody());if(!ccomma){var f=e.find("span.comma").first();if(f.length){f.focus().click()}}setTimeout(toggleGUIs,1);send_text()}function parseCommas_safe(a){try{var d=parseCommas(a);if(d&&d===-1){commaIgnoreAll()}}catch(c){var b=$(tinyMCE.activeEditor.getBody()).html();log_error({e:"parse",d:a,l:b.length,b:b.substr(0,Defs.MAX_RQ_SIZE)});$("#warning").html("Der opstod en kritisk fejl under håndteringen af svaret fra serveren. Prøv evt. igen. Hvis du kan reproducere fejlen, kontakt venligst support med et eksempel på input der forårsager fejlen.");$("#warning").show();commaIgnoreAll()}}function send_text(){if(to_send_i<to_send.length){var b=to_send[to_send_i];++to_send_i;if($.trim(b).length===0){return send_text()}var a={t:b,r:ts_fail,};ts_xhr=$.ajax({url:"./callback.php?a=grammar",type:"POST",dataType:"json",headers:{HMAC:g_access.hmac},data:a,}).done(parseCommas_safe).fail(function(){checkDone();alert("Kunne ikke gennemføre checkning af grammatik - er du sikker på at du har adgang til dette værktøj?");mvid_keepalive_at(100)})}}function commaIgnoreAll(){var a=$(tinyMCE.activeEditor.getBody());a.find(".popover").remove();a.find("span.comma").popover("destroy");a.find("span.comma").each(function(){var b=$(this);if(b.attr("data-types").indexOf("@insert")!==-1){b.replaceWith("")}else{b.replaceWith(b.text())}});$("#btn-correct-all,#btn-wrong-all,#btn-close").addClass("disabled");ccomma=null;a.attr("contenteditable",true).focus()}function checkDone(){if(tinyMCE&&tinyMCE.activeEditor){var a=$(tinyMCE.activeEditor.getBody());commaIgnoreAll();a.find(tnjq).removeAttr("id")}}function check(h,u){if($("#btn-check").hasClass("disabled")){return}$("#warning").hide();checkDone();$("#btn-check").addClass("disabled");var f=$("iframe");$("#working").show().offset(f.offset()).width(f.width()).height(f.height()).focus();var b=$(tinyMCE.activeEditor.getBody());prepEditorContent(b);last_result="";to_send=[];to_send_i=0;ts_fail=0;ccomma=null;var r=$(findTextNodes(b.get(0))).closest(tnjq).get();for(var w=0;w<r.length;++w){var k=false;var n=[];var g=false;for(var v=0;v<r[w].childNodes.length;++v){if($.inArray(r[w].childNodes[v].nodeName,text_nodes)!==-1){if(n.length&&g){$(n).wrapAll('<div class="unwrap"></div>')}k=true;n=[];g=false;continue}if(r[w].childNodes[v].nodeType===1||(r[w].childNodes[v].nodeType===3&&/\S/.test(r[w].childNodes[v].nodeValue))){g=true}n.push(r[w].childNodes[v])}if(n.length&&k&&g){$(n).wrapAll('<div class="unwrap"></div>')}}var t=[];if(u){var a=findTextNodes(b.get(0));var m=findTextNodes(u.getStart())[0];var x=findTextNodes(u.getEnd())[0];var d=false;for(var w=0;w<a.length;++w){if(a[w]==m){d=true}if(d){t.push(a[w])}if(a[w]==x){break}}t=$(t).closest(tnjq).get()}else{t=$(findTextNodes(b.get(0))).closest(tnjq).get()}var l="";for(var w=0;w<t.length;++w){var q=$(t[w]);var c=q.clone();var z=0;var y=true;for(var v=0;v<100&&y;++v){y=false;c.find(itjq).each(function(){var e=$(this);var i=this.nodeName.toLowerCase();if($.trim(e.text())){++z;e.replaceWith("[STYLE:"+i+":"+z+"]"+e.html()+"[/STYLE:"+i+":"+z+"]")}else{e.remove()}y=true})}c=$.trim(c.html().replace(/<br\/?\s*>/g,"\n").replace(/<[^>]+>/g,"").replace(/\[(STYLE:\w+:\w+)\]/g,"<$1>").replace(/\[(\/STYLE:\w+:\w+)\]/g,"<$1>"));if(!c){continue}var o=w+1;q.attr("id","s"+o);l+="<s"+o+">\n"+decHTML(c)+"\n</s"+o+">\n\n";if(l.length>=4096){to_send.push(l);l=""}}to_send.push(l);if(!l&&!to_send.length){return}send_text()};